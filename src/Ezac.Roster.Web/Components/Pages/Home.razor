@page "/"

@rendermode InteractiveServer

@using MudBlazor
@using Ezac.Roster.Domain.Interfaces.Services

@inject NavigationManager NavigationManager
@inject IUserService UserService


<style>
    .h1 {
        text-align: center;
    }
</style>

<PageTitle>Login</PageTitle>

<h1 class="h1">EZAC Planner Login</h1>

<div>
    <MudCard>
        <MudCardContent>
            <MudTextField @bind-Value="UserName" Placeholder="Gebruikersnaam" />
            <MudTextField @bind-Value="Password" Placeholder="Wachtwoord" InputType="InputType.Password" />
            <MudIcon Icon="@(showPassword ? Icons.Material.Filled.Visibility : Icons.Material.Filled.VisibilityOff)" Size="Size.Medium" @onclick="TogglePasswordVisibility" />
        </MudCardContent>
        <MudCardActions>
            <MudButton OnClick="Login">Login</MudButton>
        </MudCardActions>
    </MudCard>
    </div>
<div>
    <label>@Message</label>
</div>
    @code{


        private string UserName;
        private string Password;
        private bool IsLoggedIn;
        private string Message = "Gelieve in te loggen";
        private bool showPassword = false;

        private async Task Login()
        {
            if (Password == "ezac")
            {
                var users = await UserService.GetAllAsync();
                var user = users.Value.FirstOrDefault(u => u.Name == UserName);
                if (user != null)
                {
                    if (user.IsAdmin == true)
                    {
                        IsLoggedIn = true;
                        Message = "Logging in";
                        NavigationManager.NavigateTo("/calendar");
                    }
                    else
                    {
                        IsLoggedIn = false;
                        Message = "U heeft geen adminrechten";
                    }
                }
                else
                {
                    IsLoggedIn = false;
                    Message = "Gebruiker bestaat niet";
                }
            }
            else
            {
                IsLoggedIn = false;
                Message = "Wachtwoord is onjuist";
            }



        }

        private void TogglePasswordVisibility()
        {
            showPassword = !showPassword;
        }

    }


